openapi: '3.0.2'
info:
  title: SCS Status Page API
  version: '1.0'
components:
  schemas:
    Id:
      type: string
      readOnly: true
    IdList:
      type: array
      items:
        $ref: '#/components/schemas/Id'
    IncidentImpactType:
      type: string
    IncidentPhase:
      type: string
    IncidentUpdate:
      type: object
      properties:
        id:
          $ref: '#/components/schemas/Id'
        text:
          type: string
        createdAt:
          type: string
          format: date-time
      required:
        - id
        - text
        - createdAt
    Labels:
      type: object
      additionalProperties:
        type: string
    Component:
      type: object
      properties:
        id:
          $ref: '#/components/schemas/Id'
        displayName:
          type: string
        labels:
          $ref: '#/components/schemas/Labels'
        affectedBy:
          $ref: '#/components/schemas/IdList'
      required:
        - id
    Incident:
      type: object
      properties:
        id:
          $ref: '#/components/schemas/Id'
        title:
          type: string
        description:
          type: string
        updates:
          $ref: '#/components/schemas/IdList'
        affects:
          $ref: '#/components/schemas/IdList'
        beganAt:
          type: string
          format: date-time
        endedAt:
          type: string
          format: date-time
          nullable: true
        impactType:
          $ref: '#/components/schemas/IncidentImpactType'
        phase:
          $ref: '#/components/schemas/IncidentPhase'
      required:
        - id
  requestBodies:
    ComponentRequest:
      description: Send a component
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Component'
    IncidentRequest:
      description: Send an incident
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Incident'
    IncidentUpdateRequest:
      description: Send an incident update
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/IncidentUpdate'
  responses:
    SuccessResponse:
      description: A request has successfully run
      content:
        application/json:
          schema:
            type: boolean
    IdResponse:
      description: A request returns an ID
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Id'
  parameters:
    ComponentIdPathParameter:
      name: componentId
      in: path
      required: true
      schema:
        $ref: '#/components/schemas/Id'
    IncidentIdPathParameter:
      name: incidentId
      in: path
      required: true
      schema:
        $ref: '#/components/schemas/Id'
    IncidentUpdateIdPathParameter:
      name: updateId
      in: path
      required: true
      schema:
        $ref: '#/components/schemas/Id'
paths:
  /phases:
    get:
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/IncidentPhase'
    put:
      summary: Create a new list of phases.
      requestBody:
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/IncidentPhase'
      responses:
        '200':
          $ref: "#/components/responses/SuccessResponse"
  /impacttypes:
    get:
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/IncidentImpactType'
    post:
      summary: Create a new impact type
      operationId: createImpactType
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IncidentImpactType'
      responses:
        '201':
          $ref: '#/components/responses/IdResponse'
  /impacttypes/{impactType}:
    delete:
      summary: Delete an impact type
      operationId: deleteImpactType
      parameters:
        - name: impactType
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/IncidentImpactType'
      responses:
        '200':
          $ref: "#/components/responses/SuccessResponse"
  /components:
    get:
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Component'
    post:
      summary: Create a new component
      operationId: createComponent
      requestBody:
        $ref: '#/components/requestBodies/ComponentRequest'
      responses:
        '201':
          $ref: '#/components/responses/IdResponse'
  /components/{componentId}:
    get:
      summary: Get specific component by id
      operationId: getComponent
      parameters:
      - $ref: '#/components/parameters/ComponentIdPathParameter'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Component'
    delete:
      summary: Delete a component
      operationId: deleteComponent
      parameters:
        - $ref: '#/components/parameters/ComponentIdPathParameter'
      responses:
        '200':
          $ref: "#/components/responses/SuccessResponse"
    patch:
      summary: Fully or partially change a component
      operationId: updateComponent
      parameters:
      - $ref: '#/components/parameters/ComponentIdPathParameter'
      requestBody:
        $ref: '#/components/requestBodies/ComponentRequest'
      responses:
        '200':
          $ref: "#/components/responses/SuccessResponse"
  /incidents:
    get:
      summary: Get list of incidents
      parameters:
      - in: query
        name: start
        schema:
          type: string
          format: date-time
          default: '2022-01-01T10:10:10.010Z'
        required: true
        description: Start of time frame to query for (RFC3339)
      - in: query
        name: end
        schema:
          type: string
          format: date-time
          default: '2024-01-01T10:10:10.010Z'
        required: true
        description: End of time frame to query for (RFC3339)
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Incident'
    post:
      summary: Create a new incident
      operationId: createIncident
      requestBody:
        $ref: '#/components/requestBodies/IncidentRequest'
      responses:
        '201':
          $ref: '#/components/responses/IdResponse'
  /incidents/{incidentId}:
    get:
      summary: Get specific incident by id
      operationId: getIncident
      parameters:
      - $ref: '#/components/parameters/IncidentIdPathParameter'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Incident'
    delete:
      summary: Delete a incident
      operationId: deleteIncident
      parameters:
        - $ref: '#/components/parameters/IncidentIdPathParameter'
      responses:
        '200':
          $ref: "#/components/responses/SuccessResponse"
    patch:
      summary: Fully or partially change a incident
      operationId: updateIncident
      parameters:
        - $ref: '#/components/parameters/IncidentIdPathParameter'
      requestBody:
        $ref: '#/components/requestBodies/IncidentRequest'
      responses:
        '200':
          $ref: "#/components/responses/SuccessResponse"
  /incidents/{incidentId}/updates:
    get:
      summary: Get updates of a specific incident
      operationId: getIncidentUpdates
      parameters:
        - $ref: '#/components/parameters/IncidentIdPathParameter'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/IncidentUpdate'
    post:
      summary: Create a new update to a specific incident
      operationId: createIncidentUpdate
      parameters:
        - $ref: '#/components/parameters/IncidentIdPathParameter'
      requestBody:
        $ref: '#/components/requestBodies/IncidentUpdateRequest'
      responses:
        '201':
          $ref: '#/components/responses/IdResponse'
  /incidents/{incidentId}/updates/{updateId}:
    get:
      summary: Get a specific update from a specific incident
      operationId: getIncidentUpdate
      parameters:
        - $ref: '#/components/parameters/IncidentIdPathParameter'
        - $ref: '#/components/parameters/IncidentUpdateIdPathParameter'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IncidentUpdate'
    delete:
      summary: Delete a specific update from a specific incident
      operationId: deleteIncidentUpdate
      parameters:
        - $ref: '#/components/parameters/IncidentIdPathParameter'
        - $ref: '#/components/parameters/IncidentUpdateIdPathParameter'
      responses:
        '200':
          $ref: "#/components/responses/SuccessResponse"
    patch:
      summary: Update a specific update from a specific incident
      operationId: updateIncidentUpdate
      parameters:
        - $ref: '#/components/parameters/IncidentIdPathParameter'
        - $ref: '#/components/parameters/IncidentUpdateIdPathParameter'
      requestBody:
        $ref: '#/components/requestBodies/IncidentUpdateRequest'
      responses:
        '200':
          $ref: "#/components/responses/SuccessResponse"
